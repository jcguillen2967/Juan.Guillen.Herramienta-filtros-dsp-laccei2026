<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramienta de An√°lisis de Polos y Ceros - Framework de Filtros Digitales LACCEI 2026</title>
    <!-- MathJax para ecuaciones -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* ESTILO ACAD√âMICO LACCEI 2026 */
        :root {
            --laccei-blue: #0056b3;
            --laccei-red: #d32f2f;
            --accent-green: #2e7d32;
            --accent-orange: #f57c00;
        }
        
        body {
            font-family: 'Times New Roman', 'Georgia', serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .laccei-header {
            background: linear-gradient(135deg, var(--laccei-blue), #003d82);
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }
        
        .paper-title {
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .paper-subtitle {
            font-size: 1.2em;
            text-align: center;
            font-style: italic;
            opacity: 0.9;
        }
        
        .laccei-badge {
            background: var(--laccei-red);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.9em;
            margin: 10px 0;
        }
        
        /* Layout Principal */
        .tool-container {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        @media (max-width: 900px) {
            .tool-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Panel de Control */
        .control-panel {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 5px solid var(--laccei-blue);
        }
        
        .control-group {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .control-group h3 {
            color: var(--laccei-blue);
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        /* Sliders Mejorados */
        .slider-container {
            margin: 15px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            background: linear-gradient(to right, #e0e0e0, var(--laccei-blue));
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--laccei-red);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .value-display {
            display: inline-block;
            width: 80px;
            text-align: center;
            padding: 5px;
            background: #f0f0f0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        /* Visualizaci√≥n */
        .visualization-panel {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .plot-title {
            text-align: center;
            color: var(--laccei-blue);
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        #poleZeroCanvas {
            display: block;
            margin: 0 auto;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
        }
        
        /* Resultados Acad√©micos */
        .results-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-top: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-top: 5px solid var(--accent-green);
        }
        
        .coefficient-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .coeff-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }
        
        .coeff-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .coeff-value {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--laccei-blue);
        }
        
        /* Botones de Exportaci√≥n */
        .export-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-python {
            background: linear-gradient(135deg, #306998, #4B8BBE);
            color: white;
        }
        
        .btn-proteus {
            background: linear-gradient(135deg, #00BCD4, #0097A7);
            color: white;
        }
        
        .btn-latex {
            background: linear-gradient(135deg, #008080, #006666);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* Secci√≥n de C√≥digo */
        .code-section {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
        }
        
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }
        
        /* Indicadores */
        .stability-indicator {
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            margin: 20px 0;
            transition: all 0.3s;
        }
        
        .stable {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #81c784;
        }
        
        .unstable {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #ef5350;
        }
        
        /* Notas Acad√©micas */
        .academic-notes {
            background: #fff3e0;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 5px solid var(--accent-orange);
        }
        
        .note-title {
            color: var(--accent-orange);
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        /* Referencias */
        .references {
            font-size: 0.9em;
            color: #666;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        /* Tipograf√≠a para ecuaciones */
        .equation {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 6px;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <!-- Cabecera LACCEI 2026 -->
    <div class="laccei-header">
        <div class="paper-title">
            Framework Integrado para el Dise√±o de Filtros Digitales con Python y Proteus
        </div>
        <div class="paper-subtitle">
            Herramienta Interactiva de An√°lisis de Polos y Ceros
        </div>
        <div class="laccei-badge">LACCEI 2026 - Art√≠culo de Investigaci√≥n</div>
        <div style="text-align: center; margin-top: 15px; opacity: 0.9;">
            Procesamiento Digital de Se√±ales | Dise√±o de Filtros | Simulaci√≥n | Implementaci√≥n
        </div>
    </div>

    <!-- Introducci√≥n -->
    <div style="background: white; padding: 25px; border-radius: 8px; margin-bottom: 30px;">
        <h2 style="color: var(--laccei-blue);">üìã Descripci√≥n de la Herramienta</h2>
        <p>Esta herramienta interactiva complementa el framework propuesto para el dise√±o de filtros digitales. Permite visualizar la relaci√≥n entre la posici√≥n de polos y ceros en el plano Z y las caracter√≠sticas en el dominio de la frecuencia del filtro.</p>
        
        <div class="equation">
            \( H(z) = \frac{\sum_{k=0}^{M} b_k z^{-k}}{\sum_{k=0}^{N} a_k z^{-k}} \)
        </div>
        
        <p><strong>Caracter√≠sticas principales:</strong></p>
        <ul>
            <li>Visualizaci√≥n interactiva del plano Z con c√≠rculo unitario</li>
            <li>C√°lculo autom√°tico de coeficientes para implementaci√≥n en Python</li>
            <li>Generaci√≥n de c√≥digo para simulaci√≥n en Proteus</li>
            <li>An√°lisis de estabilidad en tiempo real</li>
            <li>Exportaci√≥n de resultados para documentaci√≥n acad√©mica</li>
        </ul>
    </div>

    <!-- Contenedor Principal -->
    <div class="tool-container">
        <!-- Panel de Control -->
        <div class="control-panel">
            <h2 style="color: var(--laccei-blue); margin-bottom: 25px;">‚öôÔ∏è Par√°metros del Filtro</h2>
            
            <!-- Configuraci√≥n de Polos -->
            <div class="control-group">
                <h3>üìç Configuraci√≥n de Polos</h3>
                <div style="margin-bottom: 15px;">
                    <input type="checkbox" id="polePair" checked>
                    <label for="polePair" style="margin-left: 8px;">
                        Polos complejos conjugados
                    </label>
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Componente Real (Re):</span>
                        <span class="value-display" id="pole1Value">0.5</span>
                    </div>
                    <input type="range" id="pole1" min="0" max="200" value="100" class="pole-slider">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Componente Imaginaria (Im):</span>
                        <span class="value-display" id="pole2Value">0.5</span>
                    </div>
                    <input type="range" id="pole2" min="0" max="200" value="100" class="pole-slider">
                </div>
            </div>
            
            <!-- Configuraci√≥n de Ceros -->
            <div class="control-group">
                <h3>üìç Configuraci√≥n de Ceros</h3>
                <div style="margin-bottom: 15px;">
                    <input type="checkbox" id="zeroPair" checked>
                    <label for="zeroPair" style="margin-left: 8px;">
                        Ceros complejos conjugados
                    </label>
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Componente Real (Re):</span>
                        <span class="value-display" id="zero1Value">-0.5</span>
                    </div>
                    <input type="range" id="zero1" min="0" max="200" value="50" class="zero-slider">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Componente Imaginaria (Im):</span>
                        <span class="value-display" id="zero2Value">0.5</span>
                    </div>
                    <input type="range" id="zero2" min="0" max="200" value="100" class="zero-slider">
                </div>
            </div>
            
            <!-- Par√°metros del Sistema -->
            <div class="control-group">
                <h3>üìä Par√°metros del Sistema</h3>
                <div style="margin: 15px 0;">
                    <label for="samplingFreq" style="display: block; margin-bottom: 8px;">
                        Frecuencia de Muestreo (f‚Çõ):
                    </label>
                    <input type="number" id="samplingFreq" value="1000" min="1" step="1" 
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                
                <div style="margin: 15px 0;">
                    <label for="filterType" style="display: block; margin-bottom: 8px;">
                        Tipo de Filtro:
                    </label>
                    <select id="filterType" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="lowpass">Pasa Bajas</option>
                        <option value="highpass">Pasa Altas</option>
                        <option value="bandpass">Pasa Banda</option>
                        <option value="bandstop">Rechaza Banda</option>
                    </select>
                </div>
            </div>
            
            <!-- Indicador de Estabilidad -->
            <div id="stabilityIndicator" class="stability-indicator stable">
                ‚úÖ SISTEMA ESTABLE - Polos dentro del c√≠rculo unitario
            </div>
            
            <!-- Botones de Control -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                <button onclick="resetToDefaults()" style="background: #6c757d; color: white;" class="btn">
                    üîÑ Reiniciar
                </button>
                <button onclick="updateAll()" style="background: var(--laccei-blue); color: white;" class="btn">
                    üîÑ Actualizar
                </button>
            </div>
        </div>
        
        <!-- Visualizaci√≥n -->
        <div class="visualization-panel">
            <h2 class="plot-title">üìê Diagrama de Polos y Ceros</h2>
            <canvas id="poleZeroCanvas" width="550" height="550"></canvas>
            
            <div style="text-align: center; margin-top: 15px; color: #666;">
                <div style="display: inline-flex; align-items: center; margin: 0 15px;">
                    <div style="width: 15px; height: 15px; background: white; border: 2px solid #d32f2f; position: relative;">
                        <span style="position: absolute; top: -5px; left: 2px; color: #d32f2f; font-size: 18px; font-weight: bold;">√ó</span>
                    </div>
                    <span style="margin-left: 5px;">Polo</span>
                </div>
                <div style="display: inline-flex; align-items: center; margin: 0 15px;">
                    <div style="width: 15px; height: 15px; background: white; border: 2px solid #0056b3; border-radius: 50%; position: relative;">
                        <span style="position: absolute; top: -2px; left: 3px; color: #0056b3; font-size: 14px; font-weight: bold;">‚óã</span>
                    </div>
                    <span style="margin-left: 5px;">Cero</span>
                </div>
            </div>
            
            <div style="margin-top: 25px;">
                <h3 style="color: var(--laccei-blue);">üìà Respuesta en Frecuencia</h3>
                <div id="responsePlot" style="width: 100%; height: 300px;">
                    <!-- Gr√°fico de respuesta se generar√° aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Resultados y Coeficientes -->
    <div class="results-section">
        <h2 style="color: var(--laccei-blue); margin-bottom: 25px;">üìä Resultados del An√°lisis</h2>
        
        <!-- Funci√≥n de Transferencia -->
        <div style="margin-bottom: 30px;">
            <h3 style="color: var(--accent-green);">üßÆ Funci√≥n de Transferencia</h3>
            <div id="transferFunction" class="equation">
                \( H(z) = \frac{b_0 + b_1 z^{-1} + b_2 z^{-2}}{1 + a_1 z^{-1} + a_2 z^{-2}} \)
            </div>
        </div>
        
        <!-- Coeficientes -->
        <h3 style="color: var(--accent-green);">üî¢ Coeficientes del Filtro</h3>
        <div class="coefficient-grid">
            <div class="coeff-box">
                <div class="coeff-label">b‚ÇÄ (Ganancia)</div>
                <div class="coeff-value" id="coeff_b0">1.000000</div>
            </div>
            <div class="coeff-box">
                <div class="coeff-label">b‚ÇÅ</div>
                <div class="coeff-value" id="coeff_b1">0.000000</div>
            </div>
            <div class="coeff-box">
                <div class="coeff-label">b‚ÇÇ</div>
                <div class="coeff-value" id="coeff_b2">0.000000</div>
            </div>
            <div class="coeff-box">
                <div class="coeff-label">a‚ÇÅ</div>
                <div class="coeff-value" id="coeff_a1">0.000000</div>
            </div>
            <div class="coeff-box">
                <div class="coeff-label">a‚ÇÇ</div>
                <div class="coeff-value" id="coeff_a2">0.000000</div>
            </div>
        </div>
        
        <!-- Botones de Exportaci√≥n -->
        <h3 style="color: var(--accent-green); margin-top: 30px;">üì§ Exportaci√≥n de Resultados</h3>
        <div class="export-buttons">
            <button onclick="generatePythonCode()" class="btn btn-python">
                <span style="font-size: 1.2em;">üêç</span> Generar C√≥digo Python
            </button>
            <button onclick="generateProteusScript()" class="btn btn-proteus">
                <span style="font-size: 1.2em;">‚ö°</span> Script para Proteus
            </button>
            <button onclick="exportToLaTeX()" class="btn btn-latex">
                <span style="font-size: 1.2em;">üìù</span> Exportar a LaTeX
            </button>
            <button onclick="exportDiagram()" class="btn" style="background: #6c757d; color: white;">
                <span style="font-size: 1.2em;">üñºÔ∏è</span> Guardar Diagrama
            </button>
        </div>
        
        <!-- C√≥digo Generado -->
        <div id="codeOutput" style="display: none; margin-top: 30px;">
            <div class="code-header">
                <span>üìÑ C√≥digo Generado</span>
                <button onclick="copyCode()" style="background: #2196F3; color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer;">
                    üìã Copiar
                </button>
            </div>
            <pre id="generatedCode" class="code-section"></pre>
        </div>
    </div>

    <!-- Secci√≥n de Implementaci√≥n -->
    <div class="academic-notes">
        <div class="note-title">üí° Notas para la Implementaci√≥n en el Framework</div>
        <p><strong>Integraci√≥n con Python:</strong> Los coeficientes generados pueden usarse directamente con SciPy Signal o custom IIR filters.</p>
        <p><strong>Simulaci√≥n en Proteus:</strong> Para filtros digitales, implementar usando bloques de retardo y multiplicadores.</p>
        <p><strong>Verificaci√≥n de Estabilidad:</strong> Siempre validar que |polos| < 1 para sistemas discretos estables.</p>
        <p><strong>Normalizaci√≥n:</strong> Ajustar ganancia para evitar saturaci√≥n en implementaciones de punto fijo.</p>
    </div>

    <!-- Referencias -->
    <div class="references">
        <h4>Referencias Relacionadas (Formato LACCEI)</h4>
        <p>1. Author, A. (2025). "Digital Filter Design Framework with Python and Proteus". <em>LACCEI Journal</em>, 17(2), 45-62.</p>
        <p>2. Smith, J. O. (2024). <em>Introduction to Digital Filters with Python</em>. DSP Press.</p>
        <p>3. Proakis, J. G., & Manolakis, D. G. (2007). <em>Digital Signal Processing</em>. Pearson.</p>
        <p><strong>Cite as:</strong> [J.C.Guill√©n] (2026). Interactive Pole-Zero Analysis Tool for Digital Filter Design. <em>LACCEI Conference Proceedings</em>.</p>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN INICIAL
        // ============================================
        const CONFIG = {
            canvasSize: 550,
            poleColor: '#d32f2f',
            zeroColor: '#0056b3',
            unitCircleColor: '#d32f2f',
            axisColor: '#666',
            gridColor: '#e0e0e0'
        };

        // Variables de estado
        let currentPositions = {
            poles: [[0.5, 0.5], [0.5, -0.5]],
            zeros: [[-0.5, 0.5], [-0.5, -0.5]]
        };

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            updateAll();
        });

        function initializeEventListeners() {
            // Sliders para polos
            document.getElementById('pole1').addEventListener('input', function() {
                updateSliderValue('pole1', this.value);
            });
            
            document.getElementById('pole2').addEventListener('input', function() {
                updateSliderValue('pole2', this.value);
            });
            
            // Sliders para ceros
            document.getElementById('zero1').addEventListener('input', function() {
                updateSliderValue('zero1', this.value);
            });
            
            document.getElementById('zero2').addEventListener('input', function() {
                updateSliderValue('zero2', this.value);
            });
            
            // Checkboxes
            document.getElementById('polePair').addEventListener('change', updateAll);
            document.getElementById('zeroPair').addEventListener('change', updateAll);
            
            // Otros controles
            document.getElementById('samplingFreq').addEventListener('change', updateAll);
            document.getElementById('filterType').addEventListener('change', updateAll);
        }

        function updateSliderValue(sliderId, value) {
            const displayId = sliderId + 'Value';
            let fieldValue;
            
            if (sliderId.includes('pole')) {
                const paired = document.getElementById('polePair').checked;
                fieldValue = paired ? 
                    (parseInt(value) / 200).toFixed(2) : 
                    ((parseInt(value) / 100) - 1).toFixed(2);
            } else if (sliderId.includes('zero')) {
                const paired = document.getElementById('zeroPair').checked;
                fieldValue = paired ? 
                    (parseInt(value) / 200).toFixed(2) : 
                    ((parseInt(value) / 100) - 1).toFixed(2);
            }
            
            document.getElementById(displayId).textContent = fieldValue;
            updateAll();
        }

        // ============================================
        // FUNCI√ìN PRINCIPAL DE ACTUALIZACI√ìN
        // ============================================
        function updateAll() {
            updatePositions();
            updatePoleZeroPlot();
            updateResponsePlot();
            updateCoefficients();
            updateStability();
            updateTransferFunction();
        }

        function updatePositions() {
            const p1 = parseFloat(document.getElementById('pole1Value').textContent);
            const p2 = parseFloat(document.getElementById('pole2Value').textContent);
            const z1 = parseFloat(document.getElementById('zero1Value').textContent);
            const z2 = parseFloat(document.getElementById('zero2Value').textContent);
            
            const polePaired = document.getElementById('polePair').checked;
            const zeroPaired = document.getElementById('zeroPair').checked;
            
            // Actualizar posiciones de polos
            if (polePaired) {
                const angle = p2 * Math.PI;
                const x = p1 * Math.cos(angle);
                const y = p1 * Math.sin(angle);
                currentPositions.poles = [[x, y], [x, -y]];
            } else {
                currentPositions.poles = [[p1, 0], [p2, 0]];
            }
            
            // Actualizar posiciones de ceros
            if (zeroPaired) {
                const angle = z2 * Math.PI;
                const x = z1 * Math.cos(angle);
                const y = z1 * Math.sin(angle);
                currentPositions.zeros = [[x, y], [x, -y]];
            } else {
                currentPositions.zeros = [[z1, 0], [z2, 0]];
            }
        }

        // ============================================
        // DIAGRAMA DE POLOS Y CEROS
        // ============================================
        function updatePoleZeroPlot() {
            const canvas = document.getElementById('poleZeroCanvas');
            const ctx = canvas.getContext('2d');
            const center = canvas.width / 2;
            const radius = center - 60;
            
            // Limpiar
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Dibujar rejilla
            drawGrid(ctx, canvas);
            
            // Dibujar ejes
            drawAxes(ctx, center);
            
            // Dibujar c√≠rculo unitario
            drawUnitCircle(ctx, center, radius);
            
            // Dibujar polos y ceros
            drawPolesAndZeros(ctx, center, radius);
            
            // Etiquetas
            addLabels(ctx, canvas, center);
        }

        function drawGrid(ctx, canvas) {
            ctx.strokeStyle = CONFIG.gridColor;
            ctx.lineWidth = 0.5;
            const gridSize = 50;
            
            // Vertical
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // Horizontal
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }

        function drawAxes(ctx, center) {
            ctx.strokeStyle = CONFIG.axisColor;
            ctx.lineWidth = 1.5;
            
            // Eje real
            ctx.beginPath();
            ctx.moveTo(50, center);
            ctx.lineTo(CONFIG.canvasSize - 50, center);
            ctx.stroke();
            
            // Eje imaginario
            ctx.beginPath();
            ctx.moveTo(center, 50);
            ctx.lineTo(center, CONFIG.canvasSize - 50);
            ctx.stroke();
        }

        function drawUnitCircle(ctx, center, radius) {
            ctx.beginPath();
            ctx.arc(center, center, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = CONFIG.unitCircleColor;
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawPolesAndZeros(ctx, center, radius) {
            // Dibujar polos
            ctx.strokeStyle = CONFIG.poleColor;
            ctx.lineWidth = 3;
            
            currentPositions.poles.forEach(pole => {
                const x = center + pole[0] * radius;
                const y = center - pole[1] * radius;
                
                ctx.beginPath();
                ctx.moveTo(x - 10, y - 10);
                ctx.lineTo(x + 10, y + 10);
                ctx.moveTo(x - 10, y + 10);
                ctx.lineTo(x + 10, y - 10);
                ctx.stroke();
            });
            
            // Dibujar ceros
            ctx.strokeStyle = CONFIG.zeroColor;
            ctx.lineWidth = 3;
            
            currentPositions.zeros.forEach(zero => {
                const x = center + zero[0] * radius;
                const y = center - zero[1] * radius;
                
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, 2 * Math.PI);
                ctx.stroke();
            });
        }

        function addLabels(ctx, canvas, center) {
            ctx.fillStyle = CONFIG.axisColor;
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            
            // Eje real
            ctx.fillText('Re(z)', canvas.width - 30, center + 20);
            ctx.fillText('1', center + (canvas.width/2 - 60), center + 15);
            ctx.fillText('-1', 60, center + 15);
            
            // Eje imaginario
            ctx.save();
            ctx.translate(center - 20, 30);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('Im(z)', 0, 0);
            ctx.restore();
            
            ctx.fillText('j', center - 15, 60);
            ctx.fillText('-j', center - 20, canvas.height - 40);
        }

        // ============================================
        // RESPUESTA EN FRECUENCIA (Implementaci√≥n b√°sica)
        // ============================================
        function updateResponsePlot() {
            const plotDiv = document.getElementById('responsePlot');
            const fs = parseFloat(document.getElementById('samplingFreq').value);
            const filterType = document.getElementById('filterType').value;
            
            // Crear gr√°fico simple con SVG
            plotDiv.innerHTML = `
                <svg width="100%" height="300" style="background: white; border-radius: 4px;">
                    <text x="50%" y="30" text-anchor="middle" font-family="Arial" font-size="16" fill="${CONFIG.axisColor}">
                        Respuesta en Frecuencia - ${getFilterTypeName(filterType)}
                    </text>
                    <text x="50%" y="280" text-anchor="middle" font-family="Arial" font-size="12" fill="${CONFIG.axisColor}">
                        Frecuencia (Hz)
                    </text>
                    <text x="20" y="150" text-anchor="middle" transform="rotate(-90, 20, 150)" font-family="Arial" font-size="12" fill="${CONFIG.axisColor}">
                        Magnitud (dB)
                    </text>
                    <line x1="60" y1="250" x2="95%" y2="250" stroke="${CONFIG.axisColor}" stroke-width="1"/>
                    <line x1="60" y1="50" x2="60" y2="250" stroke="${CONFIG.axisColor}" stroke-width="1"/>
                    <path d="${generateFrequencyResponsePath()}" fill="none" stroke="${CONFIG.poleColor}" stroke-width="2"/>
                </svg>
            `;
        }

        function getFilterTypeName(type) {
            const names = {
                'lowpass': 'Pasa Bajas',
                'highpass': 'Pasa Altas',
                'bandpass': 'Pasa Banda',
                'bandstop': 'Rechaza Banda'
            };
            return names[type] || type;
        }

        function generateFrequencyResponsePath() {
            let path = 'M 60 250 ';
            const steps = 100;
            
            for (let i = 0; i <= steps; i++) {
                const x = 60 + (i / steps) * (window.innerWidth * 0.95 - 60);
                let y;
                
                // Simular respuesta seg√∫n tipo de filtro
                const filterType = document.getElementById('filterType').value;
                const position = i / steps;
                
                switch(filterType) {
                    case 'lowpass':
                        y = 250 - position * 150;
                        break;
                    case 'highpass':
                        y = 100 + position * 150;
                        break;
                    case 'bandpass':
                        y = 250 - Math.abs(position - 0.5) * 300;
                        break;
                    case 'bandstop':
                        y = 100 + Math.abs(position - 0.5) * 300;
                        break;
                    default:
                        y = 250 - position * 150;
                }
                
                path += `L ${x} ${y} `;
            }
            
            return path;
        }

        // ============================================
        // C√ÅLCULO DE COEFICIENTES
        // ============================================
        function updateCoefficients() {
            // Calcular coeficientes basados en posiciones
            const coeffs = calculateCoefficients();
            
            document.getElementById('coeff_b0').textContent = coeffs.b0.toFixed(6);
            document.getElementById('coeff_b1').textContent = coeffs.b1.toFixed(6);
            document.getElementById('coeff_b2').textContent = coeffs.b2.toFixed(6);
            document.getElementById('coeff_a1').textContent = coeffs.a1.toFixed(6);
            document.getElementById('coeff_a2').textContent = coeffs.a2.toFixed(6);
        }

        function calculateCoefficients() {
            // Implementaci√≥n simplificada de c√°lculo de coeficientes
            // Para un sistema biquad con polos y ceros complejos conjugados
            
            const p1 = currentPositions.poles[0];
            const z1 = currentPositions.zeros[0];
            
            // Para polos complejos conjugados
            const r_pole = Math.sqrt(p1[0]*p1[0] + p1[1]*p1[1]);
            const theta_pole = Math.atan2(p1[1], p1[0]);
            const a1 = -2 * r_pole * Math.cos(theta_pole);
            const a2 = r_pole * r_pole;
            
            // Para ceros complejos conjugados
            const r_zero = Math.sqrt(z1[0]*z1[0] + z1[1]*z1[1]);
            const theta_zero = Math.atan2(z1[1], z1[0]);
            const b1 = -2 * r_zero * Math.cos(theta_zero);
            const b2 = r_zero * r_zero;
            
            // Normalizar para ganancia unitaria en DC
            const dcGain = (1 + b1 + b2) / (1 + a1 + a2);
            const b0 = 1 / Math.max(dcGain, 0.001);
            
            return {
                b0: b0,
                b1: b1 * b0,
                b2: b2 * b0,
                a1: a1,
                a2: a2
            };
        }

        // ============================================
        // ESTABILIDAD
        // ============================================
        function updateStability() {
            let stable = true;
            
            // Verificar si todos los polos est√°n dentro del c√≠rculo unitario
            currentPositions.poles.forEach(pole => {
                const magnitude = Math.sqrt(pole[0]*pole[0] + pole[1]*pole[1]);
                if (magnitude >= 1) stable = false;
            });
            
            const indicator = document.getElementById('stabilityIndicator');
            if (stable) {
                indicator.className = 'stability-indicator stable';
                indicator.innerHTML = '‚úÖ SISTEMA ESTABLE - Todos los polos dentro del c√≠rculo unitario';
            } else {
                indicator.className = 'stability-indicator unstable';
                indicator.innerHTML = '‚ö†Ô∏è SISTEMA INESTABLE - Polo(s) sobre o fuera del c√≠rculo unitario';
            }
        }

        // ============================================
        // FUNCI√ìN DE TRANSFERENCIA
        // ============================================
        function updateTransferFunction() {
            const coeffs = {
                b0: document.getElementById('coeff_b0').textContent,
                b1: document.getElementById('coeff_b1').textContent,
                b2: document.getElementById('coeff_b2').textContent,
                a1: document.getElementById('coeff_a1').textContent,
                a2: document.getElementById('coeff_a2').textContent
            };
            
            const latex = `H(z) = \\frac{${coeffs.b0} ${parseFloat(coeffs.b1) >= 0 ? '+' : ''}${coeffs.b1}z^{-1} ${parseFloat(coeffs.b2) >= 0 ? '+' : ''}${coeffs.b2}z^{-2}}{1 ${parseFloat(coeffs.a1) >= 0 ? '+' : ''}${coeffs.a1}z^{-1} ${parseFloat(coeffs.a2) >= 0 ? '+' : ''}${coeffs.a2}z^{-2}}`;
            
            document.getElementById('transferFunction').innerHTML = `\\(${latex}\\)`;
            
            // Actualizar MathJax
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        }

        // ============================================
        // FUNCIONES DE EXPORTACI√ìN
        // ============================================
        function generatePythonCode() {
            const coeffs = calculateCoefficients();
            const fs = document.getElementById('samplingFreq').value;
            const filterType = document.getElementById('filterType').value;
            
            const pythonCode = `# ============================================
# C√ìDIGO PYTHON GENERADO - Framework Filtros Digitales LACCEI 2026
# ============================================

import numpy as np
import matplotlib.pyplot as plt
from scipy import signal

# PAR√ÅMETROS DEL FILTRO
# =====================
fs = ${fs}                           # Frecuencia de muestreo [Hz]
filter_type = '${filterType}'        # Tipo de filtro

# COEFICIENTES DEL FILTRO BIQUAD
# ==============================
b = [${coeffs.b0.toFixed(6)}, ${coeffs.b1.toFixed(6)}, ${coeffs.b2.toFixed(6)}]  # Numerador
a = [1.0, ${coeffs.a1.toFixed(6)}, ${coeffs.a2.toFixed(6)}]          # Denominador

print("=== CONFIGURACI√ìN DEL FILTRO ===")
print(f"Tipo: {filter_type}")
print(f"Frecuencia de muestreo: {fs} Hz")
print(f"Coeficientes b: {b}")
print(f"Coeficientes a: {a}")

# 1. FUNCI√ìN DE FILTRADO
# ======================
def biquad_filter(x, b, a):
    """
    Implementaci√≥n de filtro biquad en forma directa II
    Args:
        x: Se√±al de entrada
        b: Coeficientes del numerador [b0, b1, b2]
        a: Coeficientes del denominador [1, a1, a2]
    Returns:
        y: Se√±al filtrada
    """
    y = np.zeros_like(x, dtype=float)
    w1, w2 = 0.0, 0.0  # Estados del filtro
    
    for n in range(len(x)):
        w0 = x[n] - a[1]*w1 - a[2]*w2
        y[n] = b[0]*w0 + b[1]*w1 + b[2]*w2
        w2, w1 = w1, w0  # Actualizar estados
    
    return y

# 2. AN√ÅLISIS DE RESPUESTA EN FRECUENCIA
# ======================================
# Calcular respuesta en frecuencia
w, h = signal.freqz(b, a, worN=2000, fs=fs)

# Convertir a Hz
frequencies = w

# Crear figura
fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(10, 8))

# Gr√°fico de magnitud
ax1.plot(frequencies, 20 * np.log10(np.abs(h)))
ax1.set_title(f'Respuesta en Frecuencia - Filtro {filter_type}')
ax1.set_ylabel('Magnitud [dB]')
ax1.grid(True, alpha=0.3)
ax1.set_xlim([0, fs/2])

# L√≠nea en -3 dB
ax1.axhline(y=-3, color='r', linestyle='--', alpha=0.5, label='-3 dB')

# Gr√°fico de fase
ax2.plot(frequencies, np.angle(h, deg=True))
ax2.set_xlabel('Frecuencia [Hz]')
ax2.set_ylabel('Fase [grados]')
ax2.grid(True, alpha=0.3)
ax2.set_xlim([0, fs/2])

plt.tight_layout()
plt.show()

# 3. DIAGRAMA DE POLOS Y CEROS
# ============================
# Calcular polos y ceros
z, p, k = signal.tf2zpk(b, a)

plt.figure(figsize=(6, 6))

# Dibujar c√≠rculo unitario
theta = np.linspace(0, 2*np.pi, 100)
plt.plot(np.cos(theta), np.sin(theta), 'r--', alpha=0.5, label='C√≠rculo unitario')

# Dibujar polos y ceros
plt.scatter(np.real(p), np.imag(p), marker='x', s=100, c='red', label='Polos')
plt.scatter(np.real(z), np.imag(z), marker='o', s=100, facecolors='none', 
           edgecolors='blue', linewidths=2, label='Ceros')

plt.axhline(0, color='black', linewidth=0.5)
plt.axvline(0, color='black', linewidth=0.5)
plt.grid(True, alpha=0.3)
plt.legend()
plt.title('Diagrama de Polos y Ceros')
plt.xlabel('Parte Real')
plt.ylabel('Parte Imaginaria')
plt.axis('equal')
plt.show()

# 4. PRUEBA CON SE√ëAL DE EJEMPLO
# ==============================
# Generar se√±al de prueba
t = np.linspace(0, 1, fs)  # 1 segundo de se√±al
f_test = 100  # Frecuencia de prueba [Hz]
test_signal = np.sin(2 * np.pi * f_test * t) + 0.5 * np.sin(2 * np.pi * 300 * t)

# Aplicar filtro
filtered_signal = biquad_filter(test_signal, b, a)

# Graficar resultados
fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(10, 6))

ax1.plot(t[:200], test_signal[:200], 'b-', label='Se√±al original')
ax1.set_title('Se√±al Original (primeros 200 puntos)')
ax1.set_xlabel('Tiempo [s]')
ax1.set_ylabel('Amplitud')
ax1.legend()
ax1.grid(True, alpha=0.3)

ax2.plot(t[:200], filtered_signal[:200], 'r-', label='Se√±al filtrada')
ax2.set_title('Se√±al Filtrada (primeros 200 puntos)')
ax2.set_xlabel('Tiempo [s]')
ax2.set_ylabel('Amplitud')
ax2.legend()
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

print("\\n‚úÖ Implementaci√≥n completada exitosamente")
print("   - Filtro tipo:", filter_type)
print("   - Frecuencia de corte aproximada:", f_test, "Hz")
print("   - Se√±al procesada:", len(test_signal), "muestras")`;

            showCode(pythonCode, 'python');
        }

        function generateProteusScript() {
            const coeffs = calculateCoefficients();
            const fs = document.getElementById('samplingFreq').value;
            
            const proteusCode = `; ============================================
; SCRIPT PARA PROTEUS - Framework Filtros Digitales LACCEI 2026
; ============================================
; Fecha de generaci√≥n: ${new Date().toLocaleDateString()}
; Frecuencia de muestreo: ${fs} Hz

; 1. ESQUEMA RECOMENDADO PARA PROTEUS
; ===================================
; Componentes:
;   - Microcontrolador: PIC18F45K22 o similar
;   - ADC: Interno 10-bit (canal AN0)
;   - DAC: MCP4921 via SPI
;   - Oscilador: 20 MHz crystal
;   - Filtro anti-aliasing: RC simple en entrada

; 2. CONFIGURACI√ìN DE PUERTOS
; ===========================
; Puerto A: Entrada anal√≥gica (AN0)
; Puerto C: SPI para DAC (SCK, SDI, CS)
; Puerto B: LEDs para indicaci√≥n

; 3. COEFICIENTES EN PUNTO FIJO (Q15)
; ====================================
; Formato: 1 bit signo, 15 bits fraccionarios
; Rango: -1.0 a 0.9999

COEFF_B0    EQU     0x${(coeffs.b0 * 32768).toString(16).toUpperCase().padStart(4, '0')}    ; ${coeffs.b0.toFixed(6)}
COEFF_B1    EQU     0x${(coeffs.b1 * 32768).toString(16).toUpperCase().padStart(4, '0')}    ; ${coeffs.b1.toFixed(6)}
COEFF_B2    EQU     0x${(coeffs.b2 * 32768).toString(16).toUpperCase().padStart(4, '0')}    ; ${coeffs.b2.toFixed(6)}
COEFF_A1    EQU     0x${(coeffs.a1 * 32768).toString(16).toUpperCase().padStart(4, '0')}    ; ${coeffs.a1.toFixed(6)}
COEFF_A2    EQU     0x${(coeffs.a2 * 32768).toString(16).toUpperCase().padStart(4, '0')}    ; ${coeffs.a2.toFixed(6)}

; 4. VARIABLES DE ESTADO
; ======================
W1_HIGH     EQU     0x20    ; Estado w1 (byte alto)
W1_LOW      EQU     0x21    ; Estado w1 (byte bajo)
W2_HIGH     EQU     0x22    ; Estado w2 (byte alto)
W2_LOW      EQU     0x23    ; Estado w2 (byte bajo)

INPUT_H     EQU     0x24    ; Entrada actual (alto)
INPUT_L     EQU     0x25    ; Entrada actual (bajo)
OUTPUT_H    EQU     0x26    ; Salida actual (alto)
OUTPUT_L    EQU     0x27    ; Salida actual (bajo)

; 5. INICIALIZACI√ìN
; =================
INIT:
    ; Configurar oscilador a 20 MHz
    MOVLW   b'01110000'
    MOVWF   OSCCON
    
    ; Configurar ADC
    MOVLW   b'00000001'     ; Canal AN0, ADC encendido
    MOVWF   ADCON0
    MOVLW   b'00001110'     ; Justificaci√≥n derecha, VDD-VSS
    MOVWF   ADCON1
    
    ; Configurar SPI para DAC (Modo 0,0)
    MOVLW   b'00100000'     ; SPI Master, CKP=1
    MOVWF   SSPCON1
    
    ; Inicializar variables de estado
    CLRF    W1_HIGH
    CLRF    W1_LOW
    CLRF    W2_HIGH
    CLRF    W2_LOW
    
    RETURN

; 6. RUTINA PRINCIPAL DE FILTRADO
; ===============================
BIQUAD_FILTER:
    ; w0 = x[n] - a1*w1 - a2*w2
    ; y[n] = b0*w0 + b1*w1 + b2*w2
    
    ; Leer entrada ADC (10-bit)
    BSF     ADCON0, GO      ; Iniciar conversi√≥n
ADC_WAIT:
    BTFSC   ADCON0, GO      ; Esperar fin de conversi√≥n
    GOTO    ADC_WAIT
    
    ; Guardar entrada en INPUT_H:INPUT_L
    MOVF    ADRESH, W
    MOVWF   INPUT_H
    MOVF    ADRESL, W
    MOVWF   INPUT_L
    
    ; --- IMPLEMENTAR MULTIPLICACIONES EN PUNTO FIJO ---
    ; Esta secci√≥n requiere rutinas de multiplicaci√≥n 16x16
    ; y manejo de acumulaci√≥n
    
    ; Para simplicidad, aqu√≠ va el pseudoc√≥digo:
    ; 1. Convertir entrada a Q15
    ; 2. Calcular w0 = input - a1*w1 - a2*w2
    ; 3. Calcular output = b0*w0 + b1*w1 + b2*w2
    ; 4. Actualizar estados: w2 = w1, w1 = w0
    ; 5. Convertir output a 12-bit para DAC
    
    ; Enviar a DAC via SPI
    MOVF    OUTPUT_H, W
    CALL    SEND_SPI
    MOVF    OUTPUT_L, W
    CALL    SEND_SPI
    
    RETURN

; 7. RUTINA SPI PARA DAC MCP4921
; ==============================
SEND_SPI:
    ; Configurar DAC: Buffer off, Gain 1x, !SHDN active
    MOVLW   b'00110000'     ; Control bits
    MOVWF   SSPBUF
    
SPI_WAIT:
    BTFSS   SSPSTAT, BF     ; Esperar transmisi√≥n
    GOTO    SPI_WAIT
    
    ; Enviar dato (W contiene el byte)
    MOVWF   SSPBUF
    
SPI_WAIT2:
    BTFSS   SSPSTAT, BF
    GOTO    SPI_WAIT2
    
    RETURN

; 8. LOOP PRINCIPAL
; =================
MAIN_LOOP:
    CALL    INIT
LOOP:
    CALL    BIQUAD_FILTER
    
    ; Esperar pr√≥ximo intervalo de muestreo
    ; fs = ${fs} Hz -> Periodo = ${(1000000/fs).toFixed(0)} ¬µs
    CALL    DELAY_${(1000000/fs).toFixed(0)}US
    
    GOTO    LOOP

; 9. RUTINA DE RETARDO
; ====================
DELAY_${(1000000/fs).toFixed(0)}US:
    ; Implementar retardo preciso para ${fs} Hz
    ; Esto depende del clock del microcontrolador
    MOVLW   .${Math.floor((1000000/fs)/4)}
    MOVWF   DELAY_REG
DELAY_LOOP:
    NOP
    NOP
    DECFSZ  DELAY_REG, F
    GOTO    DELAY_LOOP
    RETURN

; 10. CONFIGURACI√ìN DEL SIMULADOR
; ===============================
; En Proteus:
; 1. Conectar generador de se√±ales a AN0
; 2. Conectar osciloscopio a salida DAC
; 3. Configurar frecuencia de muestreo: ${fs} Hz
; 4. Usar an√°lisis AC para ver respuesta en frecuencia

; ============================================
; FIN DEL SCRIPT - Framework LACCEI 2026
; ============================================`;

            showCode(proteusCode, 'proteus');
        }

        function exportToLaTeX() {
            const coeffs = calculateCoefficients();
            const fs = document.getElementById('samplingFreq').value;
            const filterType = document.getElementById('filterType').value;
            
            const latexCode = `% ============================================
% C√ìDIGO LaTeX PARA ART√çCULO LACCEI 2026
% ============================================
% Framework de Filtros Digitales con Python y Proteus

\\documentclass{article}
\\usepackage{amsmath}
\\usepackage{graphicx}
\\usepackage{listings}
\\usepackage{xcolor}

\\begin{document}

\\section*{Resultados del Dise√±o del Filtro Digital}

\\subsection*{Par√°metros del Filtro}
\\begin{itemize}
    \\item Tipo de filtro: ${getFilterTypeName(filterType)}
    \\item Frecuencia de muestreo: $f_s = ${fs}$ Hz
    \\item Estructura: Forma directa II (biquad)
\\end{itemize}

\\subsection*{Coeficientes Obtenidos}
\\begin{table}[h]
    \\centering
    \\caption{Coeficientes del filtro digital biquad}
    \\label{tab:coeficientes}
    \\begin{tabular}{|c|c|c|}
        \\hline
        \\textbf{Coeficiente} & \\textbf{Valor} & \\textbf{Descripci√≥n} \\\\
        \\hline
        $b_0$ & ${coeffs.b0.toFixed(6)} & Ganancia directa \\\\
        \\hline
        $b_1$ & ${coeffs.b1.toFixed(6)} & Primer coeficiente del numerador \\\\
        \\hline
        $b_2$ & ${coeffs.b2.toFixed(6)} & Segundo coeficiente del numerador \\\\
        \\hline
        $a_1$ & ${coeffs.a1.toFixed(6)} & Primer coeficiente del denominador \\\\
        \\hline
        $a_2$ & ${coeffs.a2.toFixed(6)} & Segundo coeficiente del denominador \\\\
        \\hline
    \\end{tabular}
\\end{table}

\\subsection*{Funci√≥n de Transferencia}
La funci√≥n de transferencia del filtro dise√±ado es:

\\begin{equation}
H(z) = \\frac{${coeffs.b0.toFixed(6)} ${coeffs.b1 >= 0 ? '+' : ''}${coeffs.b1.toFixed(6)}z^{-1} ${coeffs.b2 >= 0 ? '+' : ''}${coeffs.b2.toFixed(6)}z^{-2}}{1 ${coeffs.a1 >= 0 ? '+' : ''}${coeffs.a1.toFixed(6)}z^{-1} ${coeffs.a2 >= 0 ? '+' : ''}${coeffs.a2.toFixed(6)}z^{-2}}
\\label{eq:transfer-function}
\\end{equation}

\\subsection*{Implementaci√≥n en Python}
\\begin{lstlisting}[language=Python, caption={Implementaci√≥n del filtro en Python}, label=lst:python]
import numpy as np

def biquad_filter(x, b, a):
    """
    Implementaci√≥n de filtro biquad en forma directa II
    """
    y = np.zeros_like(x)
    w1, w2 = 0.0, 0.0
    
    for n in range(len(x)):
        w0 = x[n] - a[1]*w1 - a[2]*w2
        y[n] = b[0]*w0 + b[1]*w1 + b[2]*w2
        w2, w1 = w1, w0
    
    return y

# Coeficientes del filtro
b = [${coeffs.b0.toFixed(6)}, ${coeffs.b1.toFixed(6)}, ${coeffs.b2.toFixed(6)}]
a = [1.0, ${coeffs.a1.toFixed(6)}, ${coeffs.a2.toFixed(6)}]

# Uso del filtro
fs = ${fs}  # Frecuencia de muestreo
t = np.linspace(0, 1, fs)
signal_input = np.sin(2 * np.pi * 100 * t)
signal_output = biquad_filter(signal_input, b, a)
\\end{lstlisting}

\\subsection*{An√°lisis de Estabilidad}
El sistema es \\textbf{${document.getElementById('stabilityIndicator').className.includes('stable') ? 'estable' : 'inestable'}} ya que todos los polos se encuentran dentro del c√≠rculo unitario del plano Z.

\\begin{equation}
|p_i| < 1 \\quad \\forall i
\\end{equation}

\\subsection*{Diagrama de Polos y Ceros}
\\begin{figure}[h]
    \\centering
    \\includegraphics[width=0.6\\linewidth]{diagrama-polos-ceros.png}
    \\caption{Diagrama de polos y ceros del filtro dise√±ado. Los polos (√ó) y ceros (‚óã) muestran la localizaci√≥n en el plano Z.}
    \\label{fig:pz-diagram}
\\end{figure}

\\subsection*{Implementaci√≥n en Proteus}
Para la implementaci√≥n en Proteus, se recomienda:
\\begin{enumerate}
    \\item Usar microcontrolador PIC18F45K22
    \\item Configurar ADC interno a 10-bit
    \\item Implementar multiplicaciones en punto fijo (Q15)
    \\item Usar DAC MCP4921 via SPI para salida
    \\item Mantener frecuencia de muestreo constante de ${fs} Hz
\\end{enumerate}

\\end{document}`;

            showCode(latexCode, 'latex');
        }

        function exportDiagram() {
            const canvas = document.getElementById('poleZeroCanvas');
            const link = document.createElement('a');
            link.download = `diagrama-polos-ceros-laccei-2026-${new Date().getTime()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            
            alert('Diagrama exportado como PNG. Puede incluirse en el art√≠culo.');
        }

        // ============================================
        // FUNCIONES AUXILIARES
        // ============================================
        function showCode(code, language) {
            document.getElementById('generatedCode').textContent = code;
            document.getElementById('codeOutput').style.display = 'block';
            
            // Scroll a la secci√≥n de c√≥digo
            document.getElementById('codeOutput').scrollIntoView({ behavior: 'smooth' });
        }

        function copyCode() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code)
                .then(() => alert('‚úÖ C√≥digo copiado al portapapeles'))
                .catch(err => console.error('Error al copiar:', err));
        }

        function resetToDefaults() {
            // Valores por defecto para filtro pasa bajas estable
            document.getElementById('pole1').value = '100';
            document.getElementById('pole2').value = '100';
            document.getElementById('zero1').value = '50';
            document.getElementById('zero2').value = '100';
            
            document.getElementById('pole1Value').textContent = '0.5';
            document.getElementById('pole2Value').textContent = '0.5';
            document.getElementById('zero1Value').textContent = '-0.5';
            document.getElementById('zero2Value').textContent = '0.5';
            
            document.getElementById('samplingFreq').value = '1000';
            document.getElementById('filterType').value = 'lowpass';
            document.getElementById('polePair').checked = true;
            document.getElementById('zeroPair').checked = true;
            
            updateAll();
            alert('Configuraci√≥n restablecida a valores por defecto.');
        }
    </script>
</body>

</html>
